{% macro with_errors(field) %}
<!-- Wraps a form field with error handling. -->
<div class="form_field">
  {% if field and field.errors %}
    {% set css_class = 'has_error ' + kwargs.pop('class', '') %}
    {{ field(class=css_class, **kwargs) }}
    <ul class="errors">{% for error in field.errors %}<li>{{ error|e }}</li>{% endfor %}</ul>
  {% else %}
    {{ field(**kwargs) }}
  {% endif %}
</div>
{% endmacro %}
